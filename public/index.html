<!DOCTYPE html>
<html ng-app="jewApp">
<head>
	<title>Jewliday</title>
	<script src="angular.js"></script>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="css/bootstrap-theme.css">
	<script src="ui-bootstrap-tpls-0.12.0.js"></script>
	<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/angular_material/0.7.1/angular-material.min.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link href='http://fonts.googleapis.com/css?family=Gurajada' rel='stylesheet' type='text/css'>
	<script>
		angular.module("jewApp",["ngAnimate","ui.bootstrap","ngRoute","ngAutocomplete","file-model","file-uploader","ui.router",'uiGmapgoogle-maps'])
			.config(function($stateProvider,$urlRouterProvider,uiGmapGoogleMapApiProvider){
				    uiGmapGoogleMapApiProvider.configure({
				        //    key: 'your api key',
				        v: '3.17',
				        libraries: 'weather,geometry,visualization'
				    });
				    $urlRouterProvider
				      .when('/users/inbox', ['$state', function ($state) {
				            $state.go('usersArea.inbox.incoming');
				    }])
				     $urlRouterProvider
				      .when('/users/home', ['$state', function ($state) {
				            $state.go('usersArea.home.location');
				    }])
    				$stateProvider
					.state('home',{
						url:'/',
						templateUrl: "views/main.html"
					})
					.state('usersArea',{
						url:'/users',
						templateUrl: "views/user.html"
					})
					.state('usersArea.profile',{
						url:'/profile',
						templateUrl:'views/users.profile.html'
					})
					.state('usersArea.inbox',{
						url:'/inbox',
						templateUrl:'views/users.inbox.html',
						controller: 'inboxCtrl'
					})
					.state('usersArea.home',{
						url:'/home',
						templateUrl:'views/users.home.html',
						controller: 'homeCtrl',
						resolve: {
							addressData : function($http,userData){
								var promise = $http.get(userData.url + '/login')
								
								.then(function(result){
									console.log(result);
									var city = result.data.user.house.city.split(", ").join("+");
									var address =   result.data.user.house.homeNumber + '+' + result.data.user.house.street +',' + '+' + city;
									console.log(address);
									return address;
								})

								var location = promise.then(function(result){
									console.log(result);
									$http.get('http://maps.google.com/maps/api/geocode/json?address='+ result +'&sensor=false')
									.then(function(result){
										console.log(result.data)
										return result.data.results[0].geometry.location;
									},function(err){
										console.error(err);
									})
								})
								console.log(location)
								return location;
							}
						} 
					})

					.state('usersArea.inbox.incoming',{
						url:'/incoming',
						templateUrl:'views/users.inbox.incoming.html'
					})
					.state('usersArea.inbox.sent',{
						url:'/sent',
						templateUrl:'views/users.inbox.sent.html'
					})
					.state('usersArea.inbox.saved',{
						url:'/saved',
						templateUrl:'views/users.inbox.saved.html'
					})
					.state('usersArea.home.location',{
						url:'/location',
						templateUrl:'views/users.home.locationDetails.html'
					})
					.state('usersArea.home.photos',{
						url:'/photos',
						templateUrl:'views/users.home.photosDescription.html'
					})
					.state('usersArea.home.reviews',{
						url:'/reviews',
						templateUrl:'views/users.home.reviews.html'
					})
					.state('listHome',{
						url: '/listHome',
						templateUrl: 'views/listHome.html',
						controller: 'newHomeCtrl'
					})
					.state('listHome.address',{
						url: '/address',
						templateUrl: 'views/listHome.address.html'
					})
					.state('listHome.details',{
						url: '/details',
						templateUrl: 'views/listHome.details.html'
					})
					.state('listHome.description',{
						url: '/description',
						templateUrl: 'views/listHome.description.html'
					})
			})
	</script>
	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false"></script>
	<script src="angular-ui-router.js"></script>
	<script src="ngmodules/angular-route.js"></script>
	<script src="ngmodules/angular-animate.js"></script>
	<script src="ngmodules/ngAutocomplete.js"></script>
	<script src="../controllers.js"></script>
	<script src="../directives.js"></script>
	<script src="angular-file-model.js"></script>
	<script src="angular-file-uploader.js"></script>
	<script src='lodash.js'></script>
	<script src='angular-google-maps.js'></script>
</head>
<body ng-controller="mainCtrl">

	<div ui-view></div>
	<log-modal ng-attr-modal="sign" ng-show="sign" class="sign"></log-modal>
	<log-modal ng-attr-modal="log" ng-show="login" class="login"></log-modal>

</body>
</html>